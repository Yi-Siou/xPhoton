#golden json of 2015 is 2.318fb-1
#silver json is 2.691 fb-1
#producing histograms for fit
./run.csh #root.exe -b -q runMakeHisto.C
./mktemplate.csh


root.exe -b
.L ext-mL_fit.C
Draw_yield_treeeff(0,2); > log.ebee_0_2
.q
root.exe -b
.L ext-mL_fit.C
Draw_yield_treeeff(1,2); > log.ebee_1_2
.q
root.exe -b
.L ext-mL_fit.C
Draw_yield_treeeff(2,2); > log.ebee_2_2
.q
root.exe -b
.L ext-mL_fit.C
Draw_yield_treeeff(3,2); > log.ebee_3_2
.q



echo "ptbin/I:EBEE/I:jetbin/I:yield/F:yield_err/F" > data_yield.dat
grep "EB bin " log.ebee_0_2 | grep SIG | awk '{print $3, 0, 2, $5, $7}' >> data_yield.dat
grep "EB bin " log.ebee_1_2 | grep SIG | awk '{print $3, 1, 2, $5, $7}' >> data_yield.dat
grep "EE bin " log.ebee_2_2 | grep SIG | awk '{print $3, 2, 2, $5, $7}' >> data_yield.dat
grep "EE bin " log.ebee_3_2 | grep SIG | awk '{print $3, 3, 2, $5, $7}' >> data_yield.dat

root.exe -b
.L ext-mL_fit.C
Draw_yield_treeeff(0,2); >& log.ebee_0_2
.q
root.exe -b
.L ext-mL_fit.C
Draw_yield_treeeff(1,2); >& log.ebee_1_2
.q
root.exe -b
.L ext-mL_fit.C
Draw_yield_treeeff(2,2); >& log.ebee_2_2
.q
root.exe -b
.L ext-mL_fit.C
Draw_yield_treeeff(3,2); >& log.ebee_3_2
.q

echo "ptbin/I:EBEE/I:jetbin/I:bkg/F:bkg_err/F" > data_bkg.dat
grep "EB bin " log.ebee_0_2 | grep BKG | awk '{print $3, 0, 2, $5, $7}' >> data_bkg.dat
grep "EB bin " log.ebee_1_2 | grep BKG | awk '{print $3, 1, 2, $5, $7}' >> data_bkg.dat
grep "EE bin " log.ebee_2_2 | grep BKG | awk '{print $3, 2, 2, $5, $7}' >> data_bkg.dat
grep "EE bin " log.ebee_3_2 | grep BKG | awk '{print $3, 3, 2, $5, $7}' >> data_bkg.dat

root.exe -b -q Correct_template_bias_datayield.C

#after unfolding
cp -a   /data4/rslu/work/Unfolding/RooUnfold_development_inclusivePhoton/unfold.dat /data4/rslu/work/egamma/fall15_76x/binfit_ssBDT_multiEtaBin/data_yield_unfold.dat
paste data_yield.dat data_yield_SBfit_tempcorr.dat data_yield_unfold.dat > tmp.dat
cat tmp.dat | grep -v ptbin | awk '{printf("%7.1f $\\pm$ %5.1f & %7.1f $\\pm$ %5.1f & %7.1f $\\pm$ %5.1f \n", $4,$5,$9,$10,$14,$15)}'


root.exe -b
.L Draw_XS_JETPHOX_v1.C
compute_unfold_xs(0,2); >& log.EB_xs_0_2
compute_unfold_xs(1,2); >& log.EB_xs_1_2
compute_unfold_xs(2,2); >& log.EB_xs_2_2
compute_unfold_xs(3,2); >& log.EB_xs_3_2
.q


echo "ptbin/I:EBEE/I:jetbin/I:xs/D:xs_err/D" > data_xs.dat
grep ^ptbin log.EB_xs_0_2 | grep ebeebin | awk '{print $2, $4, $6, $8, $10}' >> data_xs.dat
grep ^ptbin log.EB_xs_1_2 | grep ebeebin | awk '{print $2, $4, $6, $8, $10}' >> data_xs.dat
grep ^ptbin log.EB_xs_2_2 | grep ebeebin | awk '{print $2, $4, $6, $8, $10}' >> data_xs.dat
grep ^ptbin log.EB_xs_3_2 | grep ebeebin | awk '{print $2, $4, $6, $8, $10}' >> data_xs.dat


echo "ptbin/I:EBEE/I:jetbin/I:xs/D:xs_stat_err/D:xs_sys_err/D" > data_xs_2error.dat
grep -A1 ^ptbin log.EB_xs_0_2 | grep "2 errors" | awk '{print $3, $4, $5, $7, $9, $12}' >> data_xs_2error.dat
grep -A1 ^ptbin log.EB_xs_1_2 | grep "2 errors" | awk '{print $3, $4, $5, $7, $9, $12}' >> data_xs_2error.dat
grep -A1 ^ptbin log.EB_xs_2_2 | grep "2 errors" | awk '{print $3, $4, $5, $7, $9, $12}' >> data_xs_2error.dat
grep -A1 ^ptbin log.EB_xs_3_2 | grep "2 errors" | awk '{print $3, $4, $5, $7, $9, $12}' >> data_xs_2error.dat

root.exe -b
.L Draw_XS_JETPHOX_v3.C
Draw_XS_JETPHOX_v3(0,2); >& log.Draw_XS_1
Draw_XS_JETPHOX_v3(1,2); >& log.Draw_XS_2
Draw_XS_JETPHOX_v3(2,2); >& log.Draw_XS_3
Draw_XS_JETPHOX_v3(3,2); >& log.Draw_XS_4
.q

#for XS table
#grep -v ptbin data_xs.dat | awk '{printf "%.2e $\\pm$ %.2e \n", $4,$5}'
#%cat mcfm.dat | awk '{printf "%.2e\n", $4*0.001}'


#grep \(stat\) log.EB_xs_[0-3]_2 | grep "2 error" | awk '{printf("$%.2e} %s %.2e}$ %s $%s %.2e}$ %s\n",$7,$8,$9,$10,$11,$12,$13,$14,$15,$16)}' > tmp.dat
grep xs_2 log.EB_xs_[0-3]_2 | awk '{printf("$(%s) %s %s$\n", $2, $3, $4)}' > tmp.dat
grep "JETPHOX xs" log.Draw_XS_[1-4] | awk '{printf("& (%s) %s %s \n", $3, $4, $5)}' >tmp_j.dat
grep ratioJETPHOX log.Draw_XS_[1-6] | awk '{print "& ",$2,$3,$4}' >tmp_r.dat 
paste -d " " ptbin.dat tmp.dat tmp_j.dat tmp_r.dat endline.dat


for latex (not anymore)
###grep -v ptbin data_yield.dat | awk '{printf "%.2f $\\pm$ %.2f \n", $4,$5}'


print sys table
EB
cat eff.dat | awk '{printf "%.3f & %.3f & %.3f & %.3f & %.3f & %.3f \\\\ \n", $5, $7, $9, $11, $13, $14}'
